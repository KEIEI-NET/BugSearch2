{
  "path": "MIGRATION_GUIDE.md",
  "severity": 22,
  "problems": [],
  "original_code": "# 📚 移行ガイド: 旧システムから新システムへ\n\n## 🔄 変更点一覧\n\n### 廃止されたファイル\n| 旧ファイル | 新ファイル | 変更内容 |\n|-----------|-----------|----------|\n| analyze_dangerous_files.py | analyze_dangerous_files_detailed.py | 完全版に更新 |\n| analyze_dangerous_files_batch.py | analyze_dangerous_files_detailed.py | 統合 |\n| merge_batch_reports.py | merge_detailed_reports.py | 新形式対応 |\n\n### レポート形式の変更\n| 旧レポート | 新レポート | 改善点 |\n|-----------|-----------|---------|\n| AI分析_詳細.md | AI分析.md | 概要専用に |\n| AI分析_詳細_batch*.md | AI分析_詳細_改善版_batch*.md | 完全コード提供 |\n| AI分析_詳細_完全版.md | AI分析_詳細_改善版_完全版.md | 制限なし分析 |\n\n## 🚀 移行手順\n\n### Step 1: 旧レポートのバックアップ\n```bash\n# reportsディレクトリをバックアップ\ncp -r reports reports_backup_$(date +%Y%m%d)\n```\n\n### Step 2: 旧スクリプトの削除または移動\n```bash\n# 旧スクリプトを old/ ディレクトリに移動\nmkdir old\nmv analyze_dangerous_files.py old/\nmv analyze_dangerous_files_batch.py old/\nmv merge_batch_reports.py old/\n```\n\n### Step 3: 新システムの実行\n```bash\n# 自動実行\nrun_detailed_analysis.bat\n\n# または手動実行\npy -3 analyze_dangerous_files_detailed.py 1\n# ... (バッチ2-6も同様)\npy -3 merge_detai",
  "analysis": "## 1. 問題の詳細分析\n\n1. **OS によるコマンド互換性の欠如**  \n   - Step 1～3 で Bash (`cp`, `mv`, `mkdir`) と Windows (`run_detailed_analysis.bat`, `py -3`) のコマンドが混在しています。  \n   - Windows 環境で `cp` や `mv` を実行するとエラーになりバックアップや移行が止まる危険があります。逆に Linux / macOS では `.bat` や `py -3` が利用できず、新システムを起動できません。  \n   - 結果として、重要な旧レポートのバックアップが実行されない、旧スクリプトが残ったままになるなど、移行が不完全な状態で進行するリスクがあります。\n\n2. **`mkdir old` の失敗による移行停止リスク**  \n   - 既に `old` ディレクトリが存在する環境で `mkdir old` を実行するとエラーが発生し、以後のコマンドが実行されません。  \n   - 1 回目の移行に成功した後、再移行や差分移行を行う際に手順が止まってしまい、スクリプトが散在する可能性があります。\n\n3. **`mv` 実行時のファイル存在チェック不足**  \n   - `mv analyze_dangerous_files.py old/` などは対象ファイルが存在しない場合にエラーを出し、スクリプトが止まる可能性があります。  \n   - すでにファイルを削除済みの環境や、名称が変わっている環境でコマンドが失敗し、以降の移行手順が中断されます。\n\n## 2. 改善コード\n\n### Before（問題のあるコード）\n\n```bash\n# Step 1\ncp -r reports reports_backup_$(date +%Y%m%d)\n\n# Step 2\nmkdir old\nmv analyze_dangerous_files.py old/\nmv analyze_dangerous_files_batch.py old/\nmv merge_batch_reports.py old/\n\n# Step 3\nrun_detailed_analysis.bat\npy -3 analyze_dangerous_files_detailed.py 1\n```\n\n### After（改善後のコード）\n\n```bash\n# --- macOS / Linux 用 ---\n\n# Step 1: バックアップ（存在確認付き）\nif [ -d \"reports\" ]; then\n  cp -r reports \"reports_backup_$(date +%Y%m%d)\"\nelse\n  echo \"[WARN] reports ディレクトリが見つかりません。バックアップをスキップします。\"\nfi\n\n# Step 2: 旧スクリプトの退避（ディレクトリ作成と存在チェック付き）\nmkdir -p old\n[ -f analyze_dangerous_files.py ] && mv analyze_dangerous_files.py old/\n[ -f analyze_dangerous_files_batch.py ] && mv analyze_dangerous_files_batch.py old/\n[ -f merge_batch_reports.py ] && mv merge_batch_reports.py old/\n\n# Step 3: 新システムの実行\npython3 analyze_dangerous_files_detailed.py 1   # バッチ 1\n# ... 必要に応じて 2～6 を実行\npython3 merge_detailed_reports.py\n```\n\n```powershell\n# --- Windows (PowerShell) 用 ---\n\n# Step 1: バックアップ\nif (Test-Path .\\reports) {\n    $timestamp = Get-Date -Format yyyyMMdd\n    Copy-Item -Recurse -Path .\\reports -Destination (\"reports_backup_{0}\" -f $timestamp)\n} else {\n    Write-Warning \"reports ディレクトリが見つかりません。バックアップをスキップします。\"\n}\n\n# Step 2: 旧スクリプトの退避\nNew-Item -ItemType Directory -Path .\\old -ErrorAction SilentlyContinue | Out-Null\nif (Test-Path .\\analyze_dangerous_files.py)      { Move-Item .\\analyze_dangerous_files.py .\\old\\ }\nif (Test-Path .\\analyze_dangerous_files_batch.py){ Move-Item .\\analyze_dangerous_files_batch.py .\\old\\ }\nif (Test-Path .\\merge_batch_reports.py)          { Move-Item .\\merge_batch_reports.py .\\old\\ }\n\n# Step 3: 新システムの実行\n.\\run_detailed_analysis.bat         # 自動実行\npy -3 analyze_dangerous_files_detailed.py 1      # 手動実行（バッチ1）\n# ... 必要に応じて 2～6 を実行\npy -3 merge_detailed_reports.py\n```\n\n## 3. 追加の改善提案\n\n- **OS ごとの手順セクションを明確化**  \n  ドキュメントを「macOS / Linux」「Windows」で分け、利用者が自分の環境に沿った手順を一目で把握できるようにする。\n\n- **依存関係と前提条件の明記**  \n  Python バージョン、必要なライブラリ、仮想環境の利用方法などを記載し、移行後の実行失敗を防ぐ。\n\n- **検証ステップの追加**  \n  新システムのレポートが期待どおり生成されたかを確認するチェックコマンド（例: ファイルの存在確認、ログの確認）を追加し、移行完了の判断材料を増やす。",
  "model_used": "gpt-5-codex"
}