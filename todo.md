# TODO

## 最優先（Phase 1: 計測と安定化）
- [x] ボトルネック計測ログの実装を全 CLI 版へ横展開し、`--profile-index` フラグで出力を制御可能にする
- [x] 計測結果を CSV / JSONL で保存するオプションを追加し、自動ベンチマークの基盤を整備
- [x] バッチ処理化（既定 500 件、`--batch-size` で変更可能）と進捗表示のバッチ単位更新を全 CLI 版へ実装
- [x] タイムアウト／件数制限オプション（`--max-seconds` / `--max-files`）と閾値超過時の終了コード・警告メッセージを統一

- [x] 対象ディレクトリ制御（`--include` / `--exclude` glob、および既定除外リストの見直し）を全 CLI 版に適用
- [x] 並列読み込み機能（`ThreadPoolExecutor` ベース、`--worker-count` 指定、ワーカー無し時はシングルスレッド）を追加し、I/O ボトルネックを緩和
- [ ] インクリメンタル更新機能（ファイル SHA1・最終更新時刻のメタデータ保存と差分検出）を設計・実装
- [ ] ログ出力の最適化（大容量ファイルログの要約表示、進捗の粒度調整、エラー種別別カウント）

## 中優先（Phase 3: 運用フロー整備）
- [x] 検証シナリオドキュメントを `doc/TESTING.md` に作成（50/500/5000/10000 ファイルにおける手順・期待値・想定時間を明記）
- [x] 計測結果をもとにベンチマークレポートを作成し、既定値（バッチサイズ・ワーカー数・ファイルサイズ上限など）を調整、README / TECHNICAL.md を更新
- [x] CI 運用ガイドライン（ジョブ分割、アーティファクト運用、リトライ戦略、必要シークレット）を docs にまとめる
- [ ] 生成物クリーンアップ用の CLI サブコマンド（`python codex_review.py clean` など）を追加

## 低優先（Phase 4: ドキュメントとユーザビリティ）
- [ ] CLI 各版の機能差比較表を README または docs に追加し、利用者が適切な版を選択しやすくする
- [ ] scikit-learn 非導入時のログ出力・メッセージを改善し、導入推奨やフォールバック状態を明示
- [ ] 進化した CLI オプションを README / SETUP_GUIDE / doc/TECHNICAL.md に反映し、例コマンドも更新

## 調査メモ
- [ ] 並列化時のリソース消費（CPU/メモリ）を計測し、推奨ワーカー数と最小スペックを整理
- [ ] 大規模レポート生成時のファイルサイズ/行数を調査し、上限値や分割戦略を検討
- [ ] タイムアウト回避策の検証（バッチサイズ調整、`--max-seconds` に応じた逐次保存、長時間処理を細分化する CLI サブコマンドなど）
- [ ] 並列インデックス実行（`--worker-count > 0`）時の CPU / I/O 負荷と失敗時リトライ挙動を計測し、推奨パラメータと安全策をまとめる

## 参考情報
- 目標: 10k ファイル規模でもタイムアウトせず完走し、部分更新も迅速に反映できる CLI へ進化させる
- すべての CLI 版で共通フラグ・メッセージを維持し、ドキュメント更新を作業フローに組み込む
