# Phase 6 å®Ÿè£…è¨ˆç”»: ãƒãƒ¼ãƒ æ©Ÿèƒ½ã®å®Ÿè£…

*ãƒãƒ¼ã‚¸ãƒ§ãƒ³: v4.7.0 (Phase 6.0é–‹å§‹)*
*ä½œæˆæ—¥: 2025å¹´10æœˆ12æ—¥ JST*
*æœ€çµ‚æ›´æ–°: 2025å¹´10æœˆ12æ—¥ JST*

## ğŸ¯ Phase 6ã®ç›®æ¨™

**ãƒãƒ¼ãƒ ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®å®Ÿè£…**

Phase 5ã§å®Ÿè£…ã—ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è§£æã®ä¸Šã«ã€ãƒãƒ¼ãƒ ã§ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’å…±æœ‰ãƒ»æ¯”è¼ƒãƒ»è¿½è·¡ã§ãã‚‹æ©Ÿèƒ½ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

### é”æˆåŸºæº–
- [ ] ãƒ¬ãƒãƒ¼ãƒˆæ¯”è¼ƒæ©Ÿèƒ½ï¼ˆæ™‚ç³»åˆ—æ¯”è¼ƒãƒ»ãƒãƒ¼ãƒ æ¯”è¼ƒï¼‰
- [ ] é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ï¼ˆå•é¡Œä¿®æ­£çŠ¶æ³ã®å¯è¦–åŒ–ï¼‰
- [ ] ãƒãƒ¼ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆçµ±è¨ˆãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰è¡¨ç¤ºï¼‰
- [ ] ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰
- [ ] @perfectå“è³ªç¶­æŒ (å…¨ãƒ†ã‚¹ãƒˆ100%åˆæ ¼)

---

## ğŸ“Š ç¾åœ¨ã®çŠ¶æ³

### Phase 5å®Œäº† (v4.6.0) âœ…
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚¦ã‚©ãƒƒãƒãƒ£ãƒ¼æ©Ÿèƒ½å®Ÿè£…
- âœ… å·®åˆ†è§£æã‚¨ãƒ³ã‚¸ãƒ³å®Ÿè£…
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è§£æCLIå®Ÿè£…
- âœ… å…¨ãƒ†ã‚¹ãƒˆ100%åˆæ ¼ (9/9)

### Phase 6.0ã®æ–°æ©Ÿèƒ½
Phase 5ã§å®Ÿè£…ã—ãŸæ©Ÿèƒ½ã‚’æ‹¡å¼µã—ã€ä»¥ä¸‹ã‚’å®Ÿç¾ï¼š

1. **ãƒ¬ãƒãƒ¼ãƒˆæ¯”è¼ƒæ©Ÿèƒ½**
   - æ™‚ç³»åˆ—æ¯”è¼ƒï¼ˆæ”¹å–„ãƒ»æ‚ªåŒ–ã®è¿½è·¡ï¼‰
   - ãƒãƒ¼ãƒ é–“æ¯”è¼ƒï¼ˆãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼‰
   - ã‚«ãƒ†ã‚´ãƒªåˆ¥æ¯”è¼ƒ

2. **é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°**
   - å•é¡Œä¿®æ­£çŠ¶æ³ã®å¯è¦–åŒ–
   - ä¿®æ­£å„ªå…ˆåº¦ã®ææ¡ˆ
   - è‡ªå‹•é€²æ—ãƒ¬ãƒãƒ¼ãƒˆ

3. **ãƒãƒ¼ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆè¡¨ç¤º
   - ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
   - ãƒãƒ¼ãƒ è²¢çŒ®åº¦

4. **ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**
   - ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆ
   - å•é¡Œã®è­°è«–ã‚¹ãƒ¬ãƒƒãƒ‰
   - é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

---

## ğŸ”§ å®Ÿè£…é …ç›®

### 1. ãƒ¬ãƒãƒ¼ãƒˆæ¯”è¼ƒã‚¨ãƒ³ã‚¸ãƒ³ (å„ªå…ˆåº¦: é«˜)

#### core/report_comparator.py

```python
"""
ãƒ¬ãƒãƒ¼ãƒˆæ¯”è¼ƒã‚¨ãƒ³ã‚¸ãƒ³

è¤‡æ•°ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’æ¯”è¼ƒã—ã¦å·®åˆ†ã‚’æŠ½å‡º
"""

from pathlib import Path
from typing import List, Dict, Optional
from dataclasses import dataclass
from datetime import datetime
import json


@dataclass
class ReportDiff:
    """ãƒ¬ãƒãƒ¼ãƒˆå·®åˆ†æƒ…å ±"""
    new_issues: List[Dict]  # æ–°è¦å•é¡Œ
    fixed_issues: List[Dict]  # ä¿®æ­£ã•ã‚ŒãŸå•é¡Œ
    unchanged_issues: List[Dict]  # æœªä¿®æ­£ã®å•é¡Œ
    worsened_issues: List[Dict]  # æ‚ªåŒ–ã—ãŸå•é¡Œ
    total_changes: int


class ReportComparator:
    """
    ãƒ¬ãƒãƒ¼ãƒˆæ¯”è¼ƒã‚¨ãƒ³ã‚¸ãƒ³

    ä½¿ç”¨ä¾‹:
        comparator = ReportComparator()

        # 2ã¤ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’æ¯”è¼ƒ
        diff = comparator.compare_reports(
            old_report=Path("reports/2025-01-01.json"),
            new_report=Path("reports/2025-01-15.json")
        )

        print(f"æ–°è¦å•é¡Œ: {len(diff.new_issues)}ä»¶")
        print(f"ä¿®æ­£æ¸ˆã¿: {len(diff.fixed_issues)}ä»¶")
    """

    def compare_reports(
        self,
        old_report: Path,
        new_report: Path
    ) -> ReportDiff:
        """
        2ã¤ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’æ¯”è¼ƒ

        Args:
            old_report: æ—§ãƒ¬ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
            new_report: æ–°ãƒ¬ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

        Returns:
            å·®åˆ†æƒ…å ±
        """
        # ãƒ¬ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
        old_data = self._load_report(old_report)
        new_data = self._load_report(new_report)

        # å•é¡ŒIDã§ãƒãƒƒãƒ”ãƒ³ã‚°
        old_issues = {self._issue_key(i): i for i in old_data.get('issues', [])}
        new_issues = {self._issue_key(i): i for i in new_data.get('issues', [])}

        # å·®åˆ†è¨ˆç®—
        new = [new_issues[k] for k in new_issues if k not in old_issues]
        fixed = [old_issues[k] for k in old_issues if k not in new_issues]
        unchanged = [new_issues[k] for k in new_issues if k in old_issues]

        return ReportDiff(
            new_issues=new,
            fixed_issues=fixed,
            unchanged_issues=unchanged,
            worsened_issues=[],  # TODO: æ·±åˆ»åº¦å¤‰åŒ–ã‚’æ¤œå‡º
            total_changes=len(new) + len(fixed)
        )

    def _load_report(self, report_file: Path) -> Dict:
        """ãƒ¬ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿"""
        with open(report_file, 'r', encoding='utf-8') as f:
            return json.load(f)

    def _issue_key(self, issue: Dict) -> str:
        """å•é¡Œã®ä¸€æ„ã‚­ãƒ¼ã‚’ç”Ÿæˆ"""
        return f"{issue['file']}:{issue['line']}:{issue['rule_id']}"
```

### 2. é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° (å„ªå…ˆåº¦: é«˜)

#### core/progress_tracker.py

```python
"""
é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 

å•é¡Œã®ä¿®æ­£çŠ¶æ³ã‚’æ™‚ç³»åˆ—ã§è¿½è·¡
"""

from pathlib import Path
from typing import List, Dict
from datetime import datetime
import json


class ProgressTracker:
    """
    é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°

    ä½¿ç”¨ä¾‹:
        tracker = ProgressTracker(Path(".bugsearch/progress.json"))

        # ç¾åœ¨ã®çŠ¶æ…‹ã‚’è¨˜éŒ²
        tracker.record_snapshot(
            issues=current_issues,
            timestamp=datetime.now()
        )

        # é€²æ—ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
        report = tracker.generate_progress_report(days=30)
    """

    def __init__(self, storage_file: Path):
        self.storage_file = storage_file
        self.snapshots = self._load_snapshots()

    def record_snapshot(self, issues: List[Dict], timestamp: datetime):
        """
        ç¾åœ¨ã®å•é¡ŒçŠ¶æ³ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’è¨˜éŒ²

        Args:
            issues: ç¾åœ¨ã®å•é¡Œãƒªã‚¹ãƒˆ
            timestamp: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
        """
        snapshot = {
            'timestamp': timestamp.isoformat(),
            'total_issues': len(issues),
            'by_severity': self._group_by_severity(issues),
            'by_category': self._group_by_category(issues),
            'issues': issues
        }

        self.snapshots.append(snapshot)
        self._save_snapshots()

    def generate_progress_report(self, days: int = 30) -> Dict:
        """
        é€²æ—ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ

        Args:
            days: å¯¾è±¡æœŸé–“ï¼ˆæ—¥æ•°ï¼‰

        Returns:
            é€²æ—ãƒ¬ãƒãƒ¼ãƒˆ
        """
        if len(self.snapshots) < 2:
            return {'error': 'ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãŒä¸è¶³ã—ã¦ã„ã¾ã™'}

        oldest = self.snapshots[0]
        latest = self.snapshots[-1]

        return {
            'period': {
                'start': oldest['timestamp'],
                'end': latest['timestamp']
            },
            'total_issues': {
                'start': oldest['total_issues'],
                'end': latest['total_issues'],
                'change': latest['total_issues'] - oldest['total_issues']
            },
            'trend': self._calculate_trend()
        }

    def _group_by_severity(self, issues: List[Dict]) -> Dict:
        """æ·±åˆ»åº¦åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–"""
        groups = {}
        for issue in issues:
            severity = issue.get('severity', 0)
            groups[severity] = groups.get(severity, 0) + 1
        return groups

    def _group_by_category(self, issues: List[Dict]) -> Dict:
        """ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–"""
        groups = {}
        for issue in issues:
            category = issue.get('category', 'unknown')
            groups[category] = groups.get(category, 0) + 1
        return groups

    def _calculate_trend(self) -> str:
        """ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’è¨ˆç®—"""
        if len(self.snapshots) < 2:
            return 'insufficient_data'

        recent_counts = [s['total_issues'] for s in self.snapshots[-5:]]

        if all(recent_counts[i] <= recent_counts[i+1] for i in range(len(recent_counts)-1)):
            return 'worsening'
        elif all(recent_counts[i] >= recent_counts[i+1] for i in range(len(recent_counts)-1)):
            return 'improving'
        else:
            return 'fluctuating'

    def _load_snapshots(self) -> List[Dict]:
        """ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’èª­ã¿è¾¼ã¿"""
        if not self.storage_file.exists():
            return []

        with open(self.storage_file, 'r', encoding='utf-8') as f:
            return json.load(f)

    def _save_snapshots(self):
        """ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä¿å­˜"""
        self.storage_file.parent.mkdir(parents=True, exist_ok=True)

        with open(self.storage_file, 'w', encoding='utf-8') as f:
            json.dump(self.snapshots, f, indent=2, ensure_ascii=False)
```

### 3. ãƒãƒ¼ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (å„ªå…ˆåº¦: ä¸­)

#### dashboard/team_dashboard.py

```python
"""
ãƒãƒ¼ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

Web UIã§ãƒãƒ¼ãƒ çµ±è¨ˆã‚’è¡¨ç¤º
"""

from flask import Flask, render_template, jsonify
from pathlib import Path
from typing import Dict
import json


app = Flask(__name__)


@app.route('/')
def index():
    """ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸"""
    return render_template('dashboard.html')


@app.route('/api/stats')
def get_stats():
    """çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆAPIï¼‰"""
    # TODO: å®Ÿéš›ã®çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    return jsonify({
        'total_issues': 156,
        'critical': 12,
        'high': 34,
        'medium': 78,
        'low': 32,
        'trend': 'improving',
        'top_contributors': [
            {'name': 'Developer A', 'fixes': 45},
            {'name': 'Developer B', 'fixes': 32},
            {'name': 'Developer C', 'fixes': 28}
        ]
    })


@app.route('/api/progress')
def get_progress():
    """é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆAPIï¼‰"""
    # TODO: å®Ÿéš›ã®é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    return jsonify({
        'dates': ['2025-01-01', '2025-01-08', '2025-01-15'],
        'issues': [200, 175, 156],
        'fixed': [0, 25, 44]
    })


if __name__ == '__main__':
    app.run(debug=True, port=5000)
```

---

## ğŸ“‹ ãƒ†ã‚¹ãƒˆè¨ˆç”»

### test/test_phase6_team.py

```python
"""
Phase 6ãƒ†ã‚¹ãƒˆ: ãƒãƒ¼ãƒ æ©Ÿèƒ½

@perfectå“è³ªä¿è¨¼:
- ãƒ¬ãƒãƒ¼ãƒˆæ¯”è¼ƒæ©Ÿèƒ½
- é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰API
"""

import unittest
from pathlib import Path
from core.report_comparator import ReportComparator
from core.progress_tracker import ProgressTracker


class TestReportComparator(unittest.TestCase):
    """ãƒ¬ãƒãƒ¼ãƒˆæ¯”è¼ƒæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ"""

    def test_report_comparison(self):
        """ãƒ¬ãƒãƒ¼ãƒˆæ¯”è¼ƒãƒ†ã‚¹ãƒˆ"""
        # TODO: å®Ÿè£…
        pass


class TestProgressTracker(unittest.TestCase):
    """é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ"""

    def test_snapshot_recording(self):
        """ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆè¨˜éŒ²ãƒ†ã‚¹ãƒˆ"""
        # TODO: å®Ÿè£…
        pass

    def test_progress_report_generation(self):
        """é€²æ—ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ†ã‚¹ãƒˆ"""
        # TODO: å®Ÿè£…
        pass
```

---

## ğŸ“… å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### Week 1: ãƒ¬ãƒãƒ¼ãƒˆæ¯”è¼ƒæ©Ÿèƒ½ (3æ—¥é–“)
- Day 1: ReportComparatorã‚¯ãƒ©ã‚¹å®Ÿè£…
- Day 2: æ™‚ç³»åˆ—æ¯”è¼ƒæ©Ÿèƒ½
- Day 3: ãƒ†ã‚¹ãƒˆä½œæˆãƒ»å®Ÿè¡Œ

### Week 2: é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° (2æ—¥é–“)
- Day 4: ProgressTrackerã‚¯ãƒ©ã‚¹å®Ÿè£…
- Day 5: é€²æ—ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ»ãƒ†ã‚¹ãƒˆ

### Week 3: ãƒãƒ¼ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (3æ—¥é–“)
- Day 6-7: Flask APIã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
- Day 8: çµ±åˆãƒ†ã‚¹ãƒˆãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

**åˆè¨ˆ**: ç´„8æ—¥é–“ï¼ˆå®Ÿç¨¼åƒï¼‰

---

## ğŸ¯ æˆåŠŸåŸºæº–

### å¿…é ˆæ¡ä»¶
- [ ] ãƒ¬ãƒãƒ¼ãƒˆæ¯”è¼ƒãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹
- [ ] å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼

### å“è³ªåŸºæº–
- [ ] @perfectå“è³ªé”æˆ (å…¨ãƒ†ã‚¹ãƒˆ100%åˆæ ¼)
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ < 2ç§’ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰
- [ ] ãƒ‡ãƒ¼ã‚¿ä¸€è²«æ€§ã®ä¿è¨¼

---

## ğŸ”„ ä»Šå¾Œã®å±•æœ›

Phase 6å®Œäº†å¾Œã€ã•ã‚‰ãªã‚‹æ‹¡å¼µã‚’æ¤œè¨ï¼š

1. **é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ **
   - ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
   - Slack/Teamsçµ±åˆ

2. **CI/CDçµ±åˆ**
   - GitHub Actionsé€£æº
   - è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

3. **æ©Ÿæ¢°å­¦ç¿’çµ±åˆ**
   - å•é¡Œäºˆæ¸¬
   - è‡ªå‹•ä¿®æ­£ææ¡ˆ

---

*æœ€çµ‚æ›´æ–°: 2025å¹´10æœˆ12æ—¥ JST*
*Phase 6å®Ÿè£…æœŸé–“: 2025å¹´10æœˆ12æ—¥ (è¨ˆç”»ä¸­)*
*ãƒãƒ¼ã‚¸ãƒ§ãƒ³: v4.7.0 (Phase 6.0è¨ˆç”»)*
