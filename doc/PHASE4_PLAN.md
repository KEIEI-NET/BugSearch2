# Phase 4 å®Ÿè£…è¨ˆç”»: ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…

*ãƒãƒ¼ã‚¸ãƒ§ãƒ³: v4.3.0 (Phase 4.0é–‹å§‹)*
*ä½œæˆæ—¥: 2025å¹´10æœˆ12æ—¥ JST*
*æœ€çµ‚æ›´æ–°: 2025å¹´10æœˆ12æ—¥ JST*

## ðŸŽ¯ Phase 4ã®ç›®æ¨™

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…**

Phase 3ã§å®Œæˆã—ãŸYAMLãƒ«ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®ä¸Šã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‹¬è‡ªã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ãƒ»ç®¡ç†ã§ãã‚‹æŸ”è»Ÿãªã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

### é”æˆåŸºæº–
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒ«ãƒ¼ãƒ«å®šç¾©æ©Ÿèƒ½
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã®è‡ªå‹•èª­ã¿è¾¼ã¿
- [ ] ãƒ«ãƒ¼ãƒ«å„ªå…ˆé †ä½ã‚·ã‚¹ãƒ†ãƒ 
- [ ] ãƒ«ãƒ¼ãƒ«ã®æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆ
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] @perfectå“è³ªç¶­æŒ (å…¨ãƒ†ã‚¹ãƒˆ100%åˆæ ¼)

---

## ðŸ“Š ç¾åœ¨ã®çŠ¶æ³

### Phase 3å®Œäº† (v4.2.2) âœ…
- âœ… 10å€‹ã®ã‚³ã‚¢YAMLãƒ«ãƒ¼ãƒ«å®Ÿè£…
- âœ… 4ã‚«ãƒ†ã‚´ãƒªå®Œå…¨ã‚µãƒãƒ¼ãƒˆ
- âœ… æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯å¯¾å¿œåž‹è§£æž
- âœ… å…¨ãƒ†ã‚¹ãƒˆ100%åˆæ ¼

### Phase 4.0ã®æ–°æ©Ÿèƒ½
Phase 3ã§å®Ÿè£…ã—ãŸãƒ«ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’æ‹¡å¼µã—ã€ä»¥ä¸‹ã‚’å®Ÿç¾ï¼š

1. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ãƒ«ãƒ¼ãƒ«ã®ã‚µãƒãƒ¼ãƒˆ**
   - `.bugsearch/rules/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è‡ªå‹•æ¤œå‡º
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®YAMLãƒ«ãƒ¼ãƒ«å®šç¾©
   - ã‚³ã‚¢ãƒ«ãƒ¼ãƒ«ã¨ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã®çµ±åˆ

2. **ãƒ«ãƒ¼ãƒ«å„ªå…ˆé †ä½ã‚·ã‚¹ãƒ†ãƒ **
   - ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ« > ã‚³ã‚¢ãƒ«ãƒ¼ãƒ«
   - åŒåãƒ«ãƒ¼ãƒ«ã®ä¸Šæ›¸ãæ©Ÿèƒ½
   - ãƒ«ãƒ¼ãƒ«ã®ç„¡åŠ¹åŒ–æ©Ÿèƒ½

3. **ãƒ«ãƒ¼ãƒ«ç®¡ç†æ©Ÿèƒ½**
   - ãƒ«ãƒ¼ãƒ«ã®æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆ
   - ãƒ«ãƒ¼ãƒ«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
   - ãƒ«ãƒ¼ãƒ«è¨­å®šã®ä¿å­˜

---

## ðŸ”§ å®Ÿè£…é …ç›®

### 1. ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€  (å„ªå…ˆåº¦: é«˜)

```
project/
â”œâ”€â”€ .bugsearch/
â”‚   â”œâ”€â”€ config.yml                    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â”‚   â””â”€â”€ rules/                        # ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚       â”œâ”€â”€ custom/                   # ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒª
â”‚       â”‚   â”œâ”€â”€ my-rule-1.yml
â”‚       â”‚   â””â”€â”€ my-rule-2.yml
â”‚       â”œâ”€â”€ database/                 # ã‚³ã‚¢ã‚«ãƒ†ã‚´ãƒªæ‹¡å¼µ
â”‚       â”‚   â””â”€â”€ custom-query.yml
â”‚       â””â”€â”€ disabled.yml              # ç„¡åŠ¹åŒ–ã™ã‚‹ã‚³ã‚¢ãƒ«ãƒ¼ãƒ«ä¸€è¦§
```

### 2. ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«å®šç¾©ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ (å„ªå…ˆåº¦: é«˜)

#### åŸºæœ¬çš„ãªã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«
```yaml
# .bugsearch/rules/custom/forbidden-api.yml
rule:
  id: "CUSTOM_FORBIDDEN_API"
  category: "custom"
  name: "Forbidden API Usage"
  description: "ç¤¾å†…ã§ç¦æ­¢ã•ã‚Œã¦ã„ã‚‹APIã®ä½¿ç”¨ã‚’æ¤œå‡º"
  base_severity: 8

  patterns:
    csharp:
      - pattern: 'LegacyDatabase\\.Connect'
        context: "Legacy database API usage (forbidden)"

      - pattern: 'OldAuthService\\.Authenticate'
        context: "Deprecated authentication service"

  context_modifiers:
    - condition:
        code_context: '// TEMPORARY'
      action:
        severity_adjustment: -3
        note: "ä¸€æ™‚çš„ãªä½¿ç”¨ã¨ã—ã¦ãƒžãƒ¼ã‚¯ã•ã‚Œã¦ã„ã¾ã™"

  fixes:
    csharp:
      - "æ–°ã—ã„APIä½¿ç”¨: ModernDatabase.ConnectAsync()"
      - "æ–°ã—ã„èªè¨¼: AuthServiceV2.AuthenticateAsync()"
```

#### ãƒ«ãƒ¼ãƒ«ç„¡åŠ¹åŒ–è¨­å®š
```yaml
# .bugsearch/rules/disabled.yml
disabled_rules:
  # ã‚³ã‚¢ãƒ«ãƒ¼ãƒ«ã®ç„¡åŠ¹åŒ–
  - "DB_SELECT_STAR"           # SELECT * ã‚’è¨±å¯
  - "SOLID_LARGE_CLASS"        # å¤§ããªã‚¯ãƒ©ã‚¹ã‚’è¨±å¯

  # ã‚«ãƒ†ã‚´ãƒªå…¨ä½“ã®ç„¡åŠ¹åŒ–
  - category: "performance"    # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ«ãƒ¼ãƒ«å…¨ä½“ã‚’ç„¡åŠ¹åŒ–

  # ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ã¿ç„¡åŠ¹åŒ–
  - rule: "SEC_SQL_INJECTION"
    paths:
      - "test/**/*.cs"         # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ç„¡åŠ¹
      - "legacy/**/*.php"      # ãƒ¬ã‚¬ã‚·ãƒ¼ã‚³ãƒ¼ãƒ‰ã§ã¯ç„¡åŠ¹
```

### 3. ãƒ«ãƒ¼ãƒ«ãƒ­ãƒ¼ãƒ€ãƒ¼ã®æ‹¡å¼µ (å„ªå…ˆåº¦: é«˜)

#### core/rule_engine.py ã®æ‹¡å¼µ

```python
from pathlib import Path
from typing import List, Dict, Optional
from dataclasses import dataclass

@dataclass
class RuleConfig:
    """ãƒ«ãƒ¼ãƒ«è¨­å®š"""
    enabled: bool = True
    priority: int = 0  # é«˜ã„ã»ã©å„ªå…ˆ
    override_severity: Optional[int] = None

class RuleLoader:
    """æ‹¡å¼µãƒ«ãƒ¼ãƒ«ãƒ­ãƒ¼ãƒ€ãƒ¼"""

    def __init__(self, project_root: Path):
        self.project_root = project_root
        self.core_rules_dir = Path("rules")
        self.custom_rules_dir = project_root / ".bugsearch" / "rules"
        self.disabled_rules_file = self.custom_rules_dir / "disabled.yml"

    def load_all_rules(self) -> List[Rule]:
        """
        å…¨ãƒ«ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿ï¼ˆã‚³ã‚¢ + ã‚«ã‚¹ã‚¿ãƒ ï¼‰

        å„ªå…ˆé †ä½:
        1. ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ï¼ˆ.bugsearch/rules/ï¼‰
        2. ã‚³ã‚¢ãƒ«ãƒ¼ãƒ«ï¼ˆrules/ï¼‰

        ç„¡åŠ¹åŒ–:
        - disabled.yml ã«è¨˜è¼‰ã•ã‚ŒãŸãƒ«ãƒ¼ãƒ«ã¯ã‚¹ã‚­ãƒƒãƒ—
        """
        # ç„¡åŠ¹åŒ–è¨­å®šã‚’èª­ã¿è¾¼ã¿
        disabled = self._load_disabled_rules()

        # ã‚³ã‚¢ãƒ«ãƒ¼ãƒ«èª­ã¿è¾¼ã¿
        core_rules = self._load_from_directory(self.core_rules_dir, priority=0)

        # ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«èª­ã¿è¾¼ã¿
        custom_rules = []
        if self.custom_rules_dir.exists():
            custom_rules = self._load_from_directory(
                self.custom_rules_dir,
                priority=100
            )

        # ãƒ«ãƒ¼ãƒ«ã‚’ãƒžãƒ¼ã‚¸ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã§ä¸Šæ›¸ãï¼‰
        all_rules = self._merge_rules(core_rules, custom_rules)

        # ç„¡åŠ¹åŒ–ã•ã‚ŒãŸãƒ«ãƒ¼ãƒ«ã‚’é™¤å¤–
        active_rules = [r for r in all_rules if not self._is_disabled(r, disabled)]

        return active_rules

    def _load_disabled_rules(self) -> Dict:
        """ç„¡åŠ¹åŒ–è¨­å®šã‚’èª­ã¿è¾¼ã¿"""
        if not self.disabled_rules_file.exists():
            return {}

        with open(self.disabled_rules_file, 'r', encoding='utf-8') as f:
            config = yaml.safe_load(f)
            return config.get('disabled_rules', [])

    def _merge_rules(self, core: List[Rule], custom: List[Rule]) -> List[Rule]:
        """
        ãƒ«ãƒ¼ãƒ«ã‚’ãƒžãƒ¼ã‚¸

        åŒã˜IDã®ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚‹å ´åˆã€ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã§ä¸Šæ›¸ã
        """
        rules_dict = {r.id: r for r in core}

        for custom_rule in custom:
            if custom_rule.id in rules_dict:
                print(f"âš ï¸  ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ« '{custom_rule.id}' ãŒã‚³ã‚¢ãƒ«ãƒ¼ãƒ«ã‚’ä¸Šæ›¸ãã—ã¾ã™")
            rules_dict[custom_rule.id] = custom_rule

        return list(rules_dict.values())

    def _is_disabled(self, rule: Rule, disabled_config: List) -> bool:
        """ãƒ«ãƒ¼ãƒ«ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª"""
        for item in disabled_config:
            if isinstance(item, str):
                # ãƒ«ãƒ¼ãƒ«IDæŒ‡å®š
                if rule.id == item:
                    return True
            elif isinstance(item, dict):
                # ã‚«ãƒ†ã‚´ãƒªæŒ‡å®š
                if item.get('category') == rule.category:
                    return True
                # ãƒ‘ã‚¹æŒ‡å®šã®ç„¡åŠ¹åŒ–
                if item.get('rule') == rule.id and 'paths' in item:
                    # TODO: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ãƒžãƒƒãƒãƒ³ã‚°å®Ÿè£…
                    pass

        return False
```

### 4. ãƒ«ãƒ¼ãƒ«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ (å„ªå…ˆåº¦: ä¸­)

```python
class RuleValidator:
    """ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³"""

    def validate_rule(self, rule_file: Path) -> List[str]:
        """
        ãƒ«ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

        Returns:
            ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒªã‚¹ãƒˆï¼ˆç©ºãªã‚‰æ­£å¸¸ï¼‰
        """
        errors = []

        try:
            with open(rule_file, 'r', encoding='utf-8') as f:
                data = yaml.safe_load(f)

            # å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯
            if 'rule' not in data:
                errors.append("'rule'ã‚­ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
                return errors

            rule = data['rule']

            # ID ãƒã‚§ãƒƒã‚¯
            if 'id' not in rule:
                errors.append("'id'ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå¿…é ˆã§ã™")
            elif not rule['id'].isupper():
                errors.append(f"ID '{rule['id']}' ã¯å¤§æ–‡å­—ã§å®šç¾©ã—ã¦ãã ã•ã„")

            # ã‚«ãƒ†ã‚´ãƒª ãƒã‚§ãƒƒã‚¯
            valid_categories = ['database', 'security', 'solid', 'performance', 'custom']
            if 'category' not in rule:
                errors.append("'category'ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå¿…é ˆã§ã™")
            elif rule['category'] not in valid_categories:
                errors.append(f"ç„¡åŠ¹ãªã‚«ãƒ†ã‚´ãƒª: {rule['category']}")

            # ãƒ‘ã‚¿ãƒ¼ãƒ³ ãƒã‚§ãƒƒã‚¯
            if 'patterns' not in rule:
                errors.append("'patterns'ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå¿…é ˆã§ã™")
            else:
                errors.extend(self._validate_patterns(rule['patterns']))

        except yaml.YAMLError as e:
            errors.append(f"YAMLæ§‹æ–‡ã‚¨ãƒ©ãƒ¼: {e}")
        except Exception as e:
            errors.append(f"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: {e}")

        return errors

    def _validate_patterns(self, patterns: Dict) -> List[str]:
        """ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³"""
        errors = []

        valid_languages = ['csharp', 'java', 'php', 'javascript', 'typescript', 'python', 'go']

        for lang, pattern_list in patterns.items():
            if lang not in valid_languages:
                errors.append(f"æœªã‚µãƒãƒ¼ãƒˆè¨€èªž: {lang}")

            if not isinstance(pattern_list, list):
                errors.append(f"{lang}: ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ãƒªã‚¹ãƒˆå½¢å¼ã§å®šç¾©ã—ã¦ãã ã•ã„")
                continue

            for i, pattern in enumerate(pattern_list):
                if 'pattern' not in pattern:
                    errors.append(f"{lang}[{i}]: 'pattern'ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå¿…é ˆã§ã™")

                # æ­£è¦è¡¨ç¾ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
                try:
                    re.compile(pattern.get('pattern', ''))
                except re.error as e:
                    errors.append(f"{lang}[{i}]: ç„¡åŠ¹ãªæ­£è¦è¡¨ç¾: {e}")

        return errors
```

### 5. CLIæ‹¡å¼µ (å„ªå…ˆåº¦: ä¸­)

```python
# codex_review_severity.py ã¸ã®è¿½åŠ 

def rules_cmd(args):
    """ãƒ«ãƒ¼ãƒ«ç®¡ç†ã‚³ãƒžãƒ³ãƒ‰"""

    if args.list:
        # ãƒ«ãƒ¼ãƒ«ä¸€è¦§è¡¨ç¤º
        list_all_rules()

    elif args.validate:
        # ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        validate_custom_rules(args.validate)

    elif args.disable:
        # ãƒ«ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ–
        disable_rule(args.disable)

    elif args.enable:
        # ãƒ«ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ–
        enable_rule(args.enable)

# CLIå¼•æ•°è¿½åŠ 
parser.add_argument('rules', nargs='?', help='ãƒ«ãƒ¼ãƒ«ç®¡ç†ã‚³ãƒžãƒ³ãƒ‰')
parser.add_argument('--list', action='store_true', help='å…¨ãƒ«ãƒ¼ãƒ«ã‚’è¡¨ç¤º')
parser.add_argument('--validate', type=str, help='ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã‚’ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³')
parser.add_argument('--disable', type=str, help='ãƒ«ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ–')
parser.add_argument('--enable', type=str, help='ãƒ«ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ–')
```

### 6. ä½¿ç”¨ä¾‹

```bash
# ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã®ä½œæˆ
mkdir -p .bugsearch/rules/custom
cat > .bugsearch/rules/custom/my-rule.yml << 'EOF'
rule:
  id: "CUSTOM_FORBIDDEN_API"
  category: "custom"
  name: "Forbidden API"
  description: "ç¦æ­¢APIã®æ¤œå‡º"
  base_severity: 8
  patterns:
    csharp:
      - pattern: 'LegacyDatabase\\.Connect'
        context: "Legacy API usage"
EOF

# ãƒ«ãƒ¼ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
python codex_review_severity.py rules --validate .bugsearch/rules/custom/my-rule.yml

# å…¨ãƒ«ãƒ¼ãƒ«ã®è¡¨ç¤ºï¼ˆã‚³ã‚¢ + ã‚«ã‚¹ã‚¿ãƒ ï¼‰
python codex_review_severity.py rules --list

# ãƒ«ãƒ¼ãƒ«ã®ç„¡åŠ¹åŒ–
python codex_review_severity.py rules --disable DB_SELECT_STAR

# åˆ†æžå®Ÿè¡Œï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«è¾¼ã¿ï¼‰
python codex_review_severity.py index
python codex_review_severity.py advise --all --out reports/custom_analysis
```

---

## ðŸ“‹ ãƒ†ã‚¹ãƒˆè¨ˆç”»

### test/test_phase4_custom_rules.py

```python
"""
Phase 4.0ãƒ†ã‚¹ãƒˆ: ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«æ©Ÿèƒ½

@perfectå“è³ªä¿è¨¼:
- ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿
- ãƒ«ãƒ¼ãƒ«å„ªå…ˆé †ä½
- ãƒ«ãƒ¼ãƒ«ç„¡åŠ¹åŒ–
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
"""

import unittest
from pathlib import Path
from core.rule_engine import RuleLoader, RuleValidator

class TestCustomRules(unittest.TestCase):
    """ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ"""

    def setUp(self):
        """ãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"""
        self.test_project = Path("test/fixtures/custom-rules-project")
        self.test_project.mkdir(parents=True, exist_ok=True)

        # ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
        custom_dir = self.test_project / ".bugsearch" / "rules" / "custom"
        custom_dir.mkdir(parents=True, exist_ok=True)

    def test_load_custom_rules(self):
        """ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª"""
        loader = RuleLoader(self.test_project)
        rules = loader.load_all_rules()

        # ã‚³ã‚¢ãƒ«ãƒ¼ãƒ« + ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ãŒå«ã¾ã‚Œã‚‹
        self.assertGreater(len(rules), 10)

    def test_rule_priority(self):
        """ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ãŒã‚³ã‚¢ãƒ«ãƒ¼ãƒ«ã‚’ä¸Šæ›¸ãã™ã‚‹ã“ã¨ã‚’ç¢ºèª"""
        # ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã§æ—¢å­˜ãƒ«ãƒ¼ãƒ«ã‚’ä¸Šæ›¸ã
        # ... ãƒ†ã‚¹ãƒˆå®Ÿè£…
        pass

    def test_rule_disable(self):
        """ãƒ«ãƒ¼ãƒ«ã®ç„¡åŠ¹åŒ–ãŒæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèª"""
        # disabled.yml ã§ãƒ«ãƒ¼ãƒ«ã‚’ç„¡åŠ¹åŒ–
        # ... ãƒ†ã‚¹ãƒˆå®Ÿè£…
        pass

    def test_rule_validation(self):
        """ãƒ«ãƒ¼ãƒ«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèª"""
        validator = RuleValidator()

        # æ­£å¸¸ãªãƒ«ãƒ¼ãƒ«
        errors = validator.validate_rule(Path("test/fixtures/valid-rule.yml"))
        self.assertEqual(len(errors), 0)

        # ä¸æ­£ãªãƒ«ãƒ¼ãƒ«
        errors = validator.validate_rule(Path("test/fixtures/invalid-rule.yml"))
        self.assertGreater(len(errors), 0)
```

---

## ðŸ“… å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### Day 1: åŸºç›¤å®Ÿè£…
- RuleLoaderæ‹¡å¼µ
- ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚µãƒãƒ¼ãƒˆ
- ãƒ«ãƒ¼ãƒ«ãƒžãƒ¼ã‚¸æ©Ÿèƒ½

### Day 2: ç®¡ç†æ©Ÿèƒ½å®Ÿè£…
- ãƒ«ãƒ¼ãƒ«ç„¡åŠ¹åŒ–æ©Ÿèƒ½
- ãƒ«ãƒ¼ãƒ«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- CLIæ‹¡å¼µ

### Day 3: ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚°
- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
- çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- ãƒã‚°ä¿®æ­£

### Day 4: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™
- RULES_GUIDE.md ä½œæˆ
- README.md æ›´æ–°
- ã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥

**åˆè¨ˆ**: ç´„4æ—¥é–“ï¼ˆå®Ÿç¨¼åƒï¼‰

---

## ðŸŽ¯ æˆåŠŸåŸºæº–

### å¿…é ˆæ¡ä»¶
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹
- [ ] ãƒ«ãƒ¼ãƒ«å„ªå…ˆé †ä½ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹
- [ ] ãƒ«ãƒ¼ãƒ«ã®ç„¡åŠ¹åŒ–ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- [ ] å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼

### å“è³ªåŸºæº–
- [ ] @perfectå“è³ªé”æˆ (å…¨ãƒ†ã‚¹ãƒˆ100%åˆæ ¼)
- [ ] ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„æº–æ‹ 
- [ ] é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] æ˜Žç¢ºãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŸºæº–
- [ ] RULES_GUIDE.md ä½œæˆå®Œäº†
- [ ] ä½¿ç”¨ä¾‹ã®å……å®Ÿ
- [ ] ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰

---

## ðŸ”„ Phase 4.1ã¸ã®å±•æœ›

Phase 4.0å®Œäº†å¾Œã€Phase 4.1ã§ã¯ä»¥ä¸‹ã‚’æ¤œè¨Žï¼š

1. **ãƒ«ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ©Ÿèƒ½**
   - ã‚ˆãä½¿ã†ãƒ«ãƒ¼ãƒ«ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæä¾›
   - å¯¾è©±åž‹ãƒ«ãƒ¼ãƒ«ç”Ÿæˆã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰

2. **ãƒ«ãƒ¼ãƒ«å…±æœ‰æ©Ÿèƒ½**
   - GitHubçµŒç”±ã§ã®ãƒ«ãƒ¼ãƒ«å…±æœ‰
   - ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ãƒªãƒã‚¸ãƒˆãƒª

3. **ãƒ«ãƒ¼ãƒ«ãƒ¡ãƒˆãƒªã‚¯ã‚¹**
   - ãƒ«ãƒ¼ãƒ«ã”ã¨ã®æ¤œå‡ºçµ±è¨ˆ
   - èª¤æ¤œçŸ¥çŽ‡ã®è¿½è·¡

---

*æœ€çµ‚æ›´æ–°: 2025å¹´10æœˆ12æ—¥ JST*
*Phase 4å®Ÿè£…æœŸé–“: 2025å¹´10æœˆ12æ—¥ (é–‹å§‹)*
*ãƒãƒ¼ã‚¸ãƒ§ãƒ³: v4.3.0 (Phase 4.0é–‹å§‹)*
