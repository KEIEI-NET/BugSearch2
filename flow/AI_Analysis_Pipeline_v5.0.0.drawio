<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" type="device">
  <diagram name="AI Analysis Pipeline v5.0.0">
    <mxGraphModel dx="2000" dy="1200" grid="1" gridSize="10" background="#ffffff">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- タイトル -->
        <mxCell id="title" value="AI Analysis Pipeline v5.0.0&#xa;BugSearch2 - マルチAIプロバイダー + キャッシュシステム" style="text;html=1;fontSize=18;fontStyle=1;fontColor=#000000;align=center" vertex="1" parent="1">
          <mxGeometry x="700" y="30" width="700" height="60" as="geometry" />
        </mxCell>

        <!-- メタデータ -->
        <mxCell id="metadata" value="作成日: 2025年10月21日 | 作成者: KEIEI.NET INC. | v5.0.0" style="text;html=1;fontSize=10;fontColor=#666666;align=center" vertex="1" parent="1">
          <mxGeometry x="700" y="90" width="700" height="20" as="geometry" />
        </mxCell>

        <!-- 開始ノード -->
        <mxCell id="start" value="開始: Adviseコマンド" style="rounded=0;whiteSpace=wrap;html=1;spacing=10;spacingTop=10;spacingLeft=10;spacingRight=10;spacingBottom=10;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#000000;strokeWidth=2;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="875" y="130" width="250" height="80" as="geometry" />
        </mxCell>

        <!-- インデックス読み込み -->
        <mxCell id="load_index" value="インデックス読み込み&#xa;&#xa;• .advice_index.jsonl&#xa;• ファイル情報取得&#xa;• タグ情報取得&#xa;• メタデータ読み込み" style="rounded=0;whiteSpace=wrap;html=1;spacing=10;spacingTop=10;spacingLeft=10;spacingRight=10;spacingBottom=10;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#000000;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="875" y="250" width="250" height="160" as="geometry" />
        </mxCell>

        <!-- 技術スタック検出 -->
        <mxCell id="tech_detect" value="技術スタック検出&#xa;&#xa;設定ファイル読み込み:&#xa;• .bugsearch.yml&#xa;&#xa;タグベース自動検出:&#xa;• tech-react, tech-angular&#xa;• tech-express, tech-fastapi&#xa;• tech-mysql, tech-postgresql&#xa;• etc. (22技術スタック)&#xa;&#xa;検出優先度:&#xa;設定ファイル OR タグ情報" style="rounded=0;whiteSpace=wrap;html=1;spacing=10;spacingTop=10;spacingLeft=10;spacingRight=10;spacingBottom=10;fillColor=#e1d5e7;strokeColor=#9673a6;fontColor=#000000;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="875" y="450" width="250" height="280" as="geometry" />
        </mxCell>

        <!-- ルールエンジン適用 -->
        <mxCell id="apply_rules" value="ルールエンジン適用&#xa;&#xa;64 YAMLルール読み込み:&#xa;&#xa;1. コアルール (rules/core/)&#xa;   • database/&#xa;   • security/&#xa;   • solid/&#xa;   • performance/&#xa;   • best-practices/&#xa;&#xa;2. 技術スタック別ルール&#xa;   (config/)&#xa;   • react-rules.yml&#xa;   • angular-rules.yml&#xa;   • etc.&#xa;&#xa;3. カスタムルール&#xa;   (.bugsearch/rules/)&#xa;   • プロジェクト固有&#xa;&#xa;優先度:&#xa;カスタム &gt; Config &gt; コア" style="rounded=0;whiteSpace=wrap;html=1;spacing=10;spacingTop=10;spacingLeft=10;spacingRight=10;spacingBottom=10;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#000000;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="875" y="770" width="250" height="440" as="geometry" />
        </mxCell>

        <!-- 深刻度スコアリング -->
        <mxCell id="severity_scoring" value="深刻度スコアリング&#xa;&#xa;ベーススコア: 1-10&#xa;&#xa;技術スタック考慮調整:&#xa;• Elasticsearch使用時&#xa;  N+1問題 10→7&#xa;  (検索はElasticsearchで処理)&#xa;&#xa;• MySQL使用時&#xa;  SELECT * 8→5&#xa;  (小規模テーブル想定)&#xa;&#xa;• React/Angular&#xa;  メモリリーク +1&#xa;  (SPA特有の長時間稼働)&#xa;&#xa;調整後スコアで&#xa;AI分析判定" style="rounded=0;whiteSpace=wrap;html=1;spacing=10;spacingTop=10;spacingLeft=10;spacingRight=10;spacingBottom=10;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#000000;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="875" y="1250" width="250" height="360" as="geometry" />
        </mxCell>

        <!-- AI分析判定分岐 -->
        <mxCell id="ai_decision" value="深刻度判定?" style="rhombus;whiteSpace=wrap;html=1;spacing=10;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#000000;strokeWidth=2;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="900" y="1650" width="200" height="100" as="geometry" />
        </mxCell>

        <!-- 重大: Opus/GPT-4o -->
        <mxCell id="high_severity" value="深刻度 15以上 (重大)&#xa;&#xa;モデル選択:&#xa;• Anthropic: Opus 4.1&#xa;• OpenAI: GPT-4o&#xa;&#xa;最大トークン: 8192&#xa;タイムアウト: 360秒" style="rounded=0;whiteSpace=wrap;html=1;spacing=10;spacingTop=10;spacingLeft=10;spacingRight=10;spacingBottom=10;fillColor=#f8cecc;strokeColor=#b85450;fontColor=#000000;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="300" y="1800" width="250" height="180" as="geometry" />
        </mxCell>

        <!-- 中: Sonnet/GPT-4o -->
        <mxCell id="medium_severity" value="深刻度 10-14 (高)&#xa;&#xa;モデル選択:&#xa;• Anthropic: Sonnet 4.5&#xa;• OpenAI: GPT-4o&#xa;&#xa;最大トークン: 8192&#xa;タイムアウト: 360秒" style="rounded=0;whiteSpace=wrap;html=1;spacing=10;spacingTop=10;spacingLeft=10;spacingRight=10;spacingBottom=10;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#000000;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="875" y="1800" width="250" height="180" as="geometry" />
        </mxCell>

        <!-- 低: Sonnet/GPT-4o-mini -->
        <mxCell id="low_severity" value="深刻度 5-9 (中)&#xa;&#xa;モデル選択:&#xa;• Anthropic: Sonnet 4.1&#xa;• OpenAI: GPT-4o-mini&#xa;&#xa;最大トークン: 8192&#xa;タイムアウト: 360秒" style="rounded=0;whiteSpace=wrap;html=1;spacing=10;spacingTop=10;spacingLeft=10;spacingRight=10;spacingBottom=10;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#000000;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="1450" y="1800" width="250" height="180" as="geometry" />
        </mxCell>

        <!-- AI APIコール -->
        <mxCell id="ai_call" value="AI APIコール&#xa;&#xa;マルチプロバイダー対応:&#xa;&#xa;Primary: Anthropic Claude&#xa;• claude-opus-4-20250514&#xa;• claude-sonnet-4-5-20250722&#xa;• claude-sonnet-4-20250514&#xa;&#xa;Fallback: OpenAI GPT&#xa;• gpt-4o (高精度)&#xa;• gpt-4o-mini (高速)&#xa;&#xa;自動フォールバック:&#xa;Claude失敗 → OpenAI実行" style="rounded=0;whiteSpace=wrap;html=1;spacing=10;spacingTop=10;spacingLeft=10;spacingRight=10;spacingBottom=10;fillColor=#e1d5e7;strokeColor=#9673a6;fontColor=#000000;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="875" y="2040" width="250" height="340" as="geometry" />
        </mxCell>

        <!-- キャッシュチェック -->
        <mxCell id="cache_check" value="キャッシュチェック&#xa;&#xa;.cache/analysis/&#xa;&#xa;MD5ハッシュベース:&#xa;• ファイル内容のMD5計算&#xa;• キャッシュキー生成&#xa;&#xa;ヒット判定:&#xa;• 同一ファイル内容&#xa;• 同一ルールID&#xa;• 同一深刻度&#xa;&#xa;ヒット → キャッシュ返却&#xa;ミス → API呼び出し" style="rounded=0;whiteSpace=wrap;html=1;spacing=10;spacingTop=10;spacingLeft=10;spacingRight=10;spacingBottom=10;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#000000;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="875" y="2420" width="250" height="320" as="geometry" />
        </mxCell>

        <!-- AI改善コード生成 -->
        <mxCell id="improvement" value="AI改善コード生成&#xa;&#xa;出力内容:&#xa;&#xa;1. 詳細な説明&#xa;   • 問題の原因&#xa;   • 影響範囲&#xa;   • セキュリティリスク&#xa;&#xa;2. 修正前コード&#xa;   • 問題箇所のハイライト&#xa;&#xa;3. 修正後コード (100点満点)&#xa;   • セキュリティ考慮&#xa;   • パフォーマンス最適化&#xa;   • ベストプラクティス適用&#xa;   • コメント付き&#xa;&#xa;4. 修正理由&#xa;   • なぜこの修正が必要か&#xa;   • どのように改善されるか" style="rounded=0;whiteSpace=wrap;html=1;spacing=10;spacingTop=10;spacingLeft=10;spacingRight=10;spacingBottom=10;fillColor=#e1d5e7;strokeColor=#9673a6;fontColor=#000000;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="875" y="2780" width="250" height="440" as="geometry" />
        </mxCell>

        <!-- レポート生成 -->
        <mxCell id="report" value="レポート生成&#xa;&#xa;Markdown形式:&#xa;&#xa;## 1. src/file.ts&#xa;&#xa;- ファイルパス: src/file.ts&#xa;- 深刻度スコア: 9/10&#xa;- ルールID: N_PLUS_ONE&#xa;- カテゴリ: database&#xa;- 言語: typescript&#xa;- タグ: tech-react, topic-performance&#xa;&#xa;### 問題の詳細&#xa;[AI分析結果]&#xa;&#xa;### 修正前コード&#xa;```typescript&#xa;// 問題のあるコード&#xa;```&#xa;&#xa;### 修正後コード (100点満点)&#xa;```typescript&#xa;// 改善されたコード&#xa;```&#xa;&#xa;### 修正理由&#xa;[詳細な説明]" style="rounded=0;whiteSpace=wrap;html=1;spacing=10;spacingTop=10;spacingLeft=10;spacingRight=10;spacingBottom=10;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#000000;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="875" y="3260" width="250" height="520" as="geometry" />
        </mxCell>

        <!-- reports/*.md 出力 -->
        <mxCell id="output" value="reports/*.md 出力&#xa;&#xa;• analysis.md&#xa;• complete_analysis.md&#xa;• etc.&#xa;&#xa;AI改善コード付き" style="rounded=0;whiteSpace=wrap;html=1;spacing=10;spacingTop=10;spacingLeft=10;spacingRight=10;spacingBottom=10;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#000000;strokeWidth=2;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="875" y="3820" width="250" height="160" as="geometry" />
        </mxCell>

        <!-- 完了 -->
        <mxCell id="complete" value="完了" style="rounded=0;whiteSpace=wrap;html=1;spacing=10;spacingTop=10;spacingLeft=10;spacingRight=10;spacingBottom=10;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#000000;strokeWidth=2;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="875" y="4020" width="250" height="80" as="geometry" />
        </mxCell>

        <!-- 接続線 -->
        <mxCell id="flow1" value="" style="endArrow=classic;html=1;strokeColor=#333333;strokeWidth=2;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="start" target="load_index">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow2" value="" style="endArrow=classic;html=1;strokeColor=#333333;strokeWidth=2;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="load_index" target="tech_detect">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow3" value="" style="endArrow=classic;html=1;strokeColor=#333333;strokeWidth=2;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="tech_detect" target="apply_rules">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow4" value="" style="endArrow=classic;html=1;strokeColor=#333333;strokeWidth=2;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="apply_rules" target="severity_scoring">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow5" value="" style="endArrow=classic;html=1;strokeColor=#333333;strokeWidth=2;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="severity_scoring" target="ai_decision">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- 分岐線 -->
        <mxCell id="flow_high" value="15以上" style="endArrow=classic;html=1;strokeColor=#b85450;strokeWidth=2;fontColor=#c62828;fontSize=11;fontStyle=1;labelBackgroundColor=#FFFFFF;labelBorderColor=none;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="ai_decision" target="high_severity">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="425" y="1700" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="flow_medium" value="10-14" style="endArrow=classic;html=1;strokeColor=#d6b656;strokeWidth=2;fontColor=#f57f17;fontSize=11;fontStyle=1;labelBackgroundColor=#FFFFFF;labelBorderColor=none;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="ai_decision" target="medium_severity">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow_low" value="5-9" style="endArrow=classic;html=1;strokeColor=#6c8ebf;strokeWidth=2;fontColor=#1976d2;fontSize=11;fontStyle=1;labelBackgroundColor=#FFFFFF;labelBorderColor=none;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="ai_decision" target="low_severity">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1575" y="1700" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- 合流線 -->
        <mxCell id="flow_high2" value="" style="endArrow=classic;html=1;strokeColor=#9673a6;strokeWidth=2;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="high_severity" target="ai_call">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="425" y="2100" />
              <mxPoint x="1000" y="2100" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="flow_medium2" value="" style="endArrow=classic;html=1;strokeColor=#9673a6;strokeWidth=2;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="medium_severity" target="ai_call">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow_low2" value="" style="endArrow=classic;html=1;strokeColor=#9673a6;strokeWidth=2;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="low_severity" target="ai_call">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1575" y="2100" />
              <mxPoint x="1000" y="2100" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="flow6" value="" style="endArrow=classic;html=1;strokeColor=#333333;strokeWidth=2;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="ai_call" target="cache_check">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow7" value="" style="endArrow=classic;html=1;strokeColor=#333333;strokeWidth=2;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="cache_check" target="improvement">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow8" value="" style="endArrow=classic;html=1;strokeColor=#333333;strokeWidth=2;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="improvement" target="report">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow9" value="" style="endArrow=classic;html=1;strokeColor=#82b366;strokeWidth=2;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="report" target="output">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow10" value="" style="endArrow=classic;html=1;strokeColor=#82b366;strokeWidth=2;edgeStyle=orthogonalEdgeStyle" edge="1" parent="1" source="output" target="complete">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
